<h3 style="color:black;font-size:14px;">Kandoro</h3>
Target: <input id="goal"  value="30" maxlength="4" size="4"><br/>
Hours : <input id="hours" value="12" maxlength="4" size="4">
<br/>
<div id="displayTime"></div>
<div id="displayPace"></div>
<h3 style="color:black;font-size:14px;" >15min Stopwatch</h3>
<div id="stopwatch-container">
    <div id="stopwatch" style="color:black;font-size:16px;" >00:00:00</div> (m:s:ms)<br/>
    <button onclick="start(true)" id="start-btn">Start</button>
    <button onclick="pause()">Pause</button>
    <button onclick="reset()">Reset</button>
    <button onclick="done()">Done</button>
</div>
<div id="history" style="color:black;font-size:14px;" >
    <h3>History</h3>
    <div id="executionHistory"></div>
</div>

<script>
    class KanbanStopWatch {

        months = {
            '1': 'Jan',
            '2': 'Feb',
            '3': 'Mar',
            '4': 'Apr',
            '5': 'May',
            '6': 'Jun',
            '7': 'Jul',
            '8': 'Aug',
            '9': 'Sep',
            '10': 'Oct',
            '11': 'Nov',
            '12': 'Dec',
        }

        constructor(){
            this.hours = 0;
            this.minutes = 0;
            this.seconds = 0;
            this.timeDistance = 0;
            this.todayDate = new Date();
        }

        calculatePace(total, hours) {
            var baseHour = this.today().getHours();;
            var tempHour = parseInt(baseHour) + hours;
            var countDownDate = new Date(this.formatToday() + tempHour + ":00:00").getTime();

            var now = new Date().getTime();
            this.timeDistance = countDownDate - now;

            this.hours = Math.floor((this.timeDistance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            this.minutes = Math.floor((this.timeDistance % (1000 * 60 * 60)) / (1000 * 60));
            this.seconds = Math.floor((this.timeDistance % (1000 * 60)) / 1000);
            var minutesLeft = hours * 60;
            var pace = minutesLeft / total;
            return pace;
        }

        formatTimeLeft(){
            var result = "Time: ";
            result += this.hours + "h " + this.minutes + "m " + this.seconds + "s ";
            return result;
        }

        formatPace(pace){
            var result = "Pace : " + parseFloat(pace).toFixed(2) + " min/item";
            return result;
        }

        isTimeOut(){
            if (this.timeDistance < 0) {
                return true;
            }else{
                return false;
            }
        }

        today(){
           return this.todayDate;      
        }

        formatToday() {
            var day   = this.today().getDate();            
            var month = this.today().getMonth() + 1;
            var year  = this.today().getFullYear();
            var result = this.monthToEnglish(month) + " " + day + ", " + year + " ";
            return result;
        }

        monthToEnglish(m) {
            return this.months[m];
        }
    }

    var ks = new KanbanStopWatch();
    var pace = 0;

    var x = setInterval(function () {
        var total = parseInt(document.getElementById("goal").value);
        var hours = parseInt(document.getElementById("hours").value);
        var pace = ks.calculatePace(total, hours);

        document.getElementById("displayTime").innerHTML = ks.formatTimeLeft();
        document.getElementById("displayPace").innerHTML = ks.formatPace(pace);

        if (ks.isTimeOut()) {
            clearInterval(x);
            document.getElementById("displayTime").innerHTML = "TIME OUT!";
        }
    }, 1000);

    var stopwatch = document.getElementById("stopwatch");
    var startBtn = document.getElementById("start-btn");
    var timeoutId = null;
    var ms = 0;
    var sec = 0;
    var min = 0;

    function start(flag) {
        if (flag) {
            startBtn.disabled = true;
        }

        timeoutId = setTimeout(function () {
            ms = parseInt(ms);
            sec = parseInt(sec);
            min = parseInt(min);
            ms++;
            if (ms == 100) {
                sec = sec + 1;
                ms = 0;
            }
            if (sec == 60) {
                min = min + 1;
                sec = 0;
            }
            if (ms < 10) {
                ms = '0' + ms;
            }
            if (sec < 10) {
                sec = '0' + sec;
            }
            if (min < 10) {
                min = '0' + min;
            }
            stopwatch.innerHTML = min + ':' + sec + ':' + ms;
            start();
        }, 10);
    }

    function pause() {
        clearTimeout(timeoutId);
        startBtn.disabled = false;
    }

    function reset() {
        ms = 0;
        sec = 0;
        min = 0;
        clearTimeout(timeoutId);
        stopwatch.innerHTML = '00:00:00';
        startBtn.disabled = false;
    }

    const milliseconds = (h, m, s) => ((h*60*60+m*60+s)*1000);

    function msToformat(ms){
        const seconds = Math.floor((ms / 1000) % 60);
        const minutes = Math.floor((ms / 1000 / 60) % 60);
        const hours = Math.floor((ms / 1000 / 60 / 60) % 24);
        const formattedTime = [
            hours.toString().padStart(2, "0"),
            minutes.toString().padStart(2, "0"),
            seconds.toString().padStart(2, "0")
        ].join(":");
        return formattedTime;
    }

    function done() {

        var total = parseInt(document.getElementById("goal").value);
        var hours = parseInt(document.getElementById("hours").value);
        var pace = ks.calculatePace(total, hours);    

        var tempTime = stopwatch.innerHTML;
        var splitswt = new String(tempTime).split(":");

        var a = milliseconds(0,pace,0);
        var b = milliseconds(0,splitswt[0],splitswt[1]);
        var diff = a-b;
        var op = "";
        if (diff >= 0) {
            op = "[+]";
        } else {
            op = "[-]";
        }
        executionHistory.innerHTML += op + msToformat(diff) + "<br/>";

        ms = 0;
        sec = 0;
        min = 0;
        clearTimeout(timeoutId);
        startBtn.disabled = false;
    }
</script>